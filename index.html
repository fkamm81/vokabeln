<!doctype html>
<html lang="de"><head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#3a86ff" />
<title>Vokabelhelden ‚Äì Latein & Englisch</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="styles.css">
<link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
<div id="app">
  <header>
    <div class="brand">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3 7h7l-5.7 4.1L18.9 21 12 16.9 5.1 21l2.6-7.9L2 9h7z"/></svg>
      <div>Vokabelhelden</div>
    </div>
    <div class="kpis">
      <div class="kpi"><span id="xp">0</span> XP</div>
      <div class="kpi">üî• <span id="streak">0</span></div>
      <div class="kpi" id="kidBadge">üëßüë¶</div>
    </div>
  </header>

  <main>
    <div class="panel grid" id="topbar">
      <div id="filtersToggle"><div><strong>Filter</strong></div><button id="btnFilters" class="iconbtn" aria-label="Filter umschalten" aria-expanded="false">‚ñæ</button></div>
      <div id="filters">
        <div class="controls">
          <select id="bookSelect" title="Buch"></select>
          <select id="langSelect" title="√úbungsrichtung"></select>
          <select id="lessonSelect" multiple size="1" title="Lektionen"></select>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="tabs" id="tabs">
        <div class="tab active" data-tab="flash">Flashcards</div>
        <div class="tab" data-tab="quiz">Quiz</div>
        <div class="tab" data-tab="listen">H√∂ren</div>
        <div class="tab" data-tab="speak">Sprechen</div>
        <div class="tab" data-tab="match">Zuordnen</div>
        <div class="tab" data-tab="write">Schreiben</div>
      </div>

      <section class="activity" id="flash">
        <div class="card big" id="flashCard">Importiere Daten im Elternbereich und w√§hle Buch & Lektionen.</div>
        <div class="actions">
          <button id="btnShow" class="wide">Aufl√∂sung zeigen</button>
          <div class="gradeRow">
            <button id="btnEasy">Leicht ‚úÖ</button>
            <button id="btnGood">Gut üôÇ</button>
            <button id="btnHard">Schwer ü§î</button>
          </div>
        </div>
      </section>

      <section class="activity hidden" id="quiz">
        <div class="card big" id="quizPrompt">‚Äì</div>
        <div class="actions" id="quizOptions"></div>
      </section>

      <section class="activity hidden" id="listen">
        <div class="card big" id="listenPrompt">üéß Wir sprechen ein Wort ‚Äì √ºbersetze es.</div>
        <input id="listenInput" type="text" placeholder="Antwort tippen‚Ä¶">
        <div class="actions">
          <button id="btnSpeak">Nochmal anh√∂ren üîä</button>
          <button id="btnCheckListen" class="wide">Pr√ºfen</button>
        </div>
      </section>

      <section class="activity hidden" id="speak">
        <div class="card big" id="speakPrompt">üéôÔ∏è Sprich die √úbersetzung von: ‚Äì</div>
        <div class="actions">
          <button id="btnStartRec">Aufnahme starten</button>
          <button id="btnStopRec" class="secondary">Stop</button>
          <button id="btnSelfOk" class="wide">Ich hab's richtig ‚úÖ</button>
        </div>
        <div class="hint" id="recOut"></div>
      </section>

      <section class="activity hidden" id="match">
        <div class="card big" id="matchGrid">Tippe jeweils Begriff ‚Üî Bedeutung an.</div>
      </section>

      <section class="activity hidden" id="write">
        <div class="card big" id="writeCard"><div id="writePrompt">Was bedeutet ‚Ä¶?</div><div id="writeFeedback" class="hint"></div></div>
        <input id="writeInput" type="text" placeholder="Antwort">
        <div class="actions">
          <button id="btnCheckWrite" class="wide">Pr√ºfen</button>
        </div>
      </section>
    </div>
  </main>

  <footer>
  <div style="display:flex; gap:12px; margin-left:auto;">
    <button id="btnTheme" class="iconbtn" aria-label="Theme">üé®</button>
    <button id="btnParent" class="iconbtn" aria-label="Elternbereich">üë®‚Äçüëß‚Äçüë¶</button>
  </div>
</footer>
</div>

<div id="parentModal" class="modal hidden" aria-modal="true" role="dialog">
  <div class="box">
    <div class="big">Elternbereich</div>
    <div class="row">
      <label>Aktives Kind:<select id="kidSelect"></select></label>
      <button id="btnAddKid">Kind hinzuf√ºgen</button>
    </div>
    <div class="row">
      <div class="panel" style="flex:1">
        <div class="big">Import</div>
        <div class="row">
          <input id="bookName" type="text" placeholder="Buchtitel (z.B. Adeamus 1)">
          <select id="baseLang"><option value="latin">Buchsprache: Latein</option><option value="english">Buchsprache: Englisch</option></select>
        </div>
        <div class="row">
          <input id="fileInput" type="file" accept=".csv,.json">
          <button id="btnImport" class="smallbtn">Importieren</button>
        </div>
        <div id="importStatus" class="hint"></div>
      </div>
      <div class="panel" style="flex:1">
        <div class="big">T√§gliches Ziel</div>
        <div class="row">
          <label>Lektionen: <input id="goalLessons" type="text" placeholder="z.B. 1,2"></label>
          <label>Minuten: <input id="goalMinutes" type="number" min="5" step="5" value="15"></label>
          <label class="switch"><input id="reminders" type="checkbox"> T√§gliche Erinnerung 17:00</label>
        </div>
        <button id="btnSaveGoal">Speichern</button>
      </div>
    </div>
    <div class="panel">
      <div class="big">Fortschritt</div>
      <div id="progressList" class="list"></div>
    </div>
    <div class="row" style="justify-content:flex-end"><button id="btnCloseParent">Schlie√üen</button></div>
  </div>
</div>

<div id="themePopup" class="hidden"><div class="theme-mini" id="themeDots"></div></div>


<!-- EARLY DEBUG + FALLBACK HANDLERS -->
<script>
(function(){
  // Create banner early
  var b = document.getElementById('dbgBanner');
  if(!b){
    b = document.createElement('div');
    b.id = 'dbgBanner';
    b.setAttribute('role','status');
    b.style.position='fixed';
    b.style.top='10px';
    b.style.left='50%';
    b.style.transform='translateX(-50%)';
    b.style.background='rgba(0,0,0,.75)';
    b.style.color='#fff';
    b.style.padding='8px 12px';
    b.style.borderRadius='12px';
    b.style.fontSize='14px';
    b.style.zIndex='10000';
    b.style.pointerEvents='none';
    b.style.maxWidth='90vw';
    b.style.textAlign='center';
    b.style.display='none';
    document.body.appendChild(b);
  }
  function show(msg){
    try{
      b.textContent = String(msg);
      b.style.display='block';
      clearTimeout(window.__dbgHide);
      window.__dbgHide = setTimeout(function(){ b.style.display='none'; }, 1400);
    }catch(e){}
  }
  window.__DBG_SHOW = show;
  window.addEventListener('error', function(e){ show('JS-Fehler: '+ (e.message||e)); });
  window.addEventListener('unhandledrejection', function(e){ show('Promise-Fehler'); });

  function byId(id){ return document.getElementById(id); }
  function safeBind(id, fn){
    var el = byId(id);
    if (!el) return;
    el.addEventListener('click', function(ev){
      show(id+': Klick');
      try{ fn(ev); }catch(err){ show('Handler-Fehler '+id); }
    }, {capture:true});
  }

  // Minimal fallback actions, unabh√§ngig von app.js
  safeBind('btnFilters', function(){
    var box = document.getElementById('filters');
    if (!box){ show('filters nicht gefunden'); return; }
    var open = !box.classList.contains('open');
    if (open) box.classList.add('open'); else box.classList.remove('open');
    var btn = document.getElementById('btnFilters');
    if (btn){ btn.setAttribute('aria-expanded', open?'true':'false'); btn.textContent = open ? '‚ñ¥' : '‚ñæ'; }
  });

  safeBind('btnTheme', function(){
    var pop = document.getElementById('themePopup');
    if (!pop){ show('themePopup nicht gefunden'); return; }
    try {
      if (typeof openThemePopup === 'function' && typeof closeThemePopup === 'function') {
        if (pop.classList.contains('hidden')) openThemePopup(); else closeThemePopup();
      } else {
        // Fallback: show box at least
        pop.classList.toggle('hidden');
      }
    } catch(e){ show('Theme-Handler-Fehler'); }
  });

  safeBind('btnParent', function(){
    var modal = document.getElementById('parentModal');
    if (!modal){ show('parentModal nicht gefunden'); return; }
    modal.classList.remove('hidden');
    document.body.classList.add('no-scroll');
  });
})();
  safeBind('btnCloseParent', function(){
    var modal = document.getElementById('parentModal');
    if (!modal){ show('parentModal nicht gefunden'); return; }
    modal.classList.add('hidden');
    document.body.classList.remove('no-scroll');
  });
</script>

<script src="app.js">  safeBind('btnCloseParent', function(){
    var modal = document.getElementById('parentModal');
    if (!modal){ show('parentModal nicht gefunden'); return; }
    modal.classList.add('hidden');
    document.body.classList.remove('no-scroll');
  });
</script>
<script> if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js'); }   safeBind('btnCloseParent', function(){
    var modal = document.getElementById('parentModal');
    if (!modal){ show('parentModal nicht gefunden'); return; }
    modal.classList.add('hidden');
    document.body.classList.remove('no-scroll');
  });
</script>

<div id="dbgBanner" role="status" aria-live="polite"></div>
</body></html>
