
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3a86ff"/>
  <title>Vokabelhelden</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css?v=rel1">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
<div id="app">
  <header>
    <div class="brand">
      <svg viewBox="0 0 24 24" fill="currentColor" width="28" height="28"><path d="M12 2l3 7h7l-5.7 4.1L18.9 21 12 16.9 5.1 21l2.6-7.9L2 9h7z"/></svg>
      <div>Vokabelhelden</div>
    </div>
    <div class="kpis">
      <div class="kpi"><span id="xp">0</span> XP</div>
      <div class="kpi">🔥 <span id="streak">0</span></div>
      <div class="kpi" id="kidBadge">👧👦</div>
    </div>
  </header>

  <main>
    <div class="panel grid" id="topbar">
      <div id="filtersToggle">
        <div><strong>Filter</strong></div>
        <button id="btnFilters" class="iconbtn" aria-label="Filter umschalten" aria-expanded="false">▾</button>
      </div>
      <div id="filters">
        <div class="controls">
          <select id="bookSelect" title="Buch"></select>
          <select id="langSelect" title="Übungsrichtung"></select>
          <select id="lessonSelect" multiple size="1" title="Lektionen"></select>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="tabs" id="tabs">
        <div class="tab active" data-tab="flash">Flashcards</div>
        <div class="tab" data-tab="quiz">Quiz</div>
        <div class="tab" data-tab="listen">Hören</div>
        <div class="tab" data-tab="speak">Sprechen</div>
        <div class="tab" data-tab="match">Zuordnen</div>
        <div class="tab" data-tab="write">Schreiben</div>
      </div>

      <section class="activity" id="flash">
        <div class="card big" id="flashCard">Importiere Daten im Elternbereich und wähle Buch & Lektionen.</div>
        <div class="actions">
          <button id="btnShow" class="wide">Auflösung zeigen</button>
          <div class="gradeRow">
            <button id="btnEasy">Leicht ✅</button>
            <button id="btnGood">Gut 🙂</button>
            <button id="btnHard">Schwer 🤔</button>
          </div>
        </div>
      </section>

      <section class="activity hidden" id="quiz">
        <div class="card big" id="quizPrompt">–</div>
        <div class="actions" id="quizOptions"></div>
      </section>

      <section class="activity hidden" id="listen">
        <div class="card big" id="listenPrompt">🎧 Wir sprechen ein Wort – übersetze es.</div>
        <input id="listenInput" type="text" placeholder="Antwort tippen…">
        <div class="actions">
          <button id="btnSpeak">Nochmal anhören 🔊</button>
          <button id="btnCheckListen" class="wide">Prüfen</button>
        </div>
      </section>

      <section class="activity hidden" id="speak">
        <div class="card big" id="speakPrompt">🎙️ Sprich die Übersetzung von: –</div>
        <div class="actions">
          <button id="btnStartRec">Aufnahme starten</button>
          <button id="btnStopRec" class="secondary">Stop</button>
          <button id="btnSelfOk" class="wide">Ich hab's richtig ✅</button>
        </div>
        <div class="hint" id="recOut"></div>
      </section>

      <section class="activity hidden" id="match">
        <div class="card big" id="matchGrid">Tippe jeweils Begriff ↔ Bedeutung an.</div>
      </section>

      <section class="activity hidden" id="write">
        <div class="card big" id="writeCard"><div id="writePrompt">Was bedeutet …?</div><div id="writeFeedback" class="hint"></div></div>
        <input id="writeInput" type="text" placeholder="Antwort">
        <div class="actions">
          <button id="btnCheckWrite" class="wide">Prüfen</button>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div style="display:flex; gap:12px; margin-left:auto;">
      <button id="btnTheme" class="iconbtn" aria-label="Theme">🎨</button>
      <button id="btnParent" class="iconbtn" aria-label="Elternbereich">👨‍👧‍👦</button>
    </div>
  </footer>
</div>

<!-- Elternbereich Modal -->
<div id="parentModal" class="modal hidden" aria-modal="true" role="dialog">
  <div class="box panel">
    <div class="big">Elternbereich</div>
    <div class="controls" style="margin-top:8px">
      <label>Aktives Kind: <select id="kidSelect"></select></label>
      <button id="btnAddKid">Kind hinzufügen</button>
    </div>
    <div class="grid" style="grid-template-columns:1fr 1fr">
      <div class="panel">
        <div class="big">Import</div>
        <div class="controls">
          <input id="bookName" type="text" placeholder="Buchtitel (z.B. Adeamus 1)">
          <select id="baseLang"><option value="latin">Buchsprache: Latein</option><option value="english">Buchsprache: Englisch</option></select>
          <input id="fileInput" type="file" accept=".csv,.json">
          <button id="btnImport">Importieren</button>
        </div>
        <div id="importStatus" class="hint"></div>
      </div>
      <div class="panel">
        <div class="big">Tägliches Ziel</div>
        <div class="controls">
          <label>Lektionen: <input id="goalLessons" type="text" placeholder="1,2"></label>
          <label>Minuten: <input id="goalMinutes" type="number" min="5" step="5" value="15"></label>
          <label><input id="reminders" type="checkbox"> Erinnerung 17:00</label>
        </div>
        <button id="btnSaveGoal">Speichern</button>
      </div>
    </div>
    <div class="panel">
      <div class="big">Fortschritt</div>
      <div id="progressList" class="list"></div>
    </div>
    <div style="display:flex;justify-content:flex-end;gap:8px">
      <button id="btnCloseParent" class="secondary">Schließen</button>
    </div>
  </div>
</div>

<!-- Theme mini popup -->
<div id="themePopup" class="hidden">
  <div class="theme-mini" id="themeDots"></div>
</div>

<!-- Early, robust handlers so the three icons always work -->
<script>
(function(){
  function on(id, fn){ var el=document.getElementById(id); if(!el) return; el.addEventListener('click', ev=>{ try{ fn(ev);}catch(e){} }, {capture:true}); }
  on('btnFilters', function(){ var box=document.getElementById('filters'); if(!box) return; var open=!box.classList.contains('open'); box.classList.toggle('open', open); var btn=document.getElementById('btnFilters'); if(btn){ btn.setAttribute('aria-expanded', open?'true':'false'); btn.textContent=open?'▴':'▾'; } });
  on('btnTheme', function(){ var pop=document.getElementById('themePopup'); if(!pop) return; if(typeof openThemePopup==='function'&&typeof closeThemePopup==='function'){ if(pop.classList.contains('hidden')) openThemePopup(); else closeThemePopup(); } else { pop.classList.toggle('hidden'); } });
  on('btnParent', function(){ var modal=document.getElementById('parentModal'); if(!modal) return; modal.classList.remove('hidden'); document.body.classList.add('no-scroll'); renderParent && renderParent(); });
  document.addEventListener('click', (e)=>{ var b=e.target.closest && e.target.closest('#btnCloseParent'); if(b){ var m=document.getElementById('parentModal'); if(m){ m.classList.add('hidden'); document.body.classList.remove('no-scroll'); } } }, {capture:true});
})();
</script>

<script src="app.js?v=rel1"></script>
<script> if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); } </script>
</body>
</html>
